# 2. Architecture Overview

## 2.1 Layered Architecture

### 2.1.1 Presentation Layer

**Mobile App (Expo React Native)**
- **ì±…ìž„**:
  - ì‹œë‹ˆì–´ ì‚¬ìš©ìž ëŒ€ë©´ UI/UX
  - ì ‘ê·¼ì„± ëª¨ë“œ ê´€ë¦¬ (í°íŠ¸, í„°ì¹˜, ëŒ€ë¹„, TTS)
  - Supabase Authë¥¼ í†µí•œ ì‚¬ìš©ìž ì¸ì¦ (anon_key ì‚¬ìš©)
  - ì½ê¸° ì „ìš© ë°ì´í„°ëŠ” Supabaseì—ì„œ ì§ì ‘ ì¡°íšŒ (RLS ë³´í˜¸)
  - ì“°ê¸°/ë¯¼ê°/ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ BFF í˜¸ì¶œ
- **ê¸ˆì§€ ì‚¬í•­**:
  - `service_role` í‚¤ ì ˆëŒ€ í¬í•¨ ê¸ˆì§€
  - RLS ìš°íšŒ ê¸ˆì§€
  - ì§ì ‘ì ì¸ ì™¸ë¶€ API í˜¸ì¶œ ìµœì†Œí™” (BFF ê²½ìœ )
  - ë³µìž¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„ ê¸ˆì§€

**Web Console (Next.js App Router)**
- **ì±…ìž„**:
  - ê°€ì¡±/ê¸°ê´€ ê´€ë¦¬ìžìš© ëŒ€ì‹œë³´ë“œ
  - ì‹œë‹ˆì–´ ì‚¬ìš© í˜„í™© ì¡°íšŒ (ì¹´ë“œ ì™„ë£Œ, ë³µì•½, ì‚¬ìš©ëŸ‰)
  - ê°€ì¡± ë§í¬ ê´€ë¦¬, ì•Œë¦¼ ì„¤ì •
  - Supabase Authë¡œ guardian/org ì—­í•  ì¸ì¦
  - ëŒ€ë¶€ë¶„ì˜ ë°ì´í„°ëŠ” BFFë¥¼ í†µí•´ ì¡°íšŒ/ìˆ˜ì •
- **ê¸ˆì§€ ì‚¬í•­**:
  - ì‹œë‹ˆì–´ì˜ ìƒì„¸ í–‰ë™ ë¡œê·¸ ë…¸ì¶œ (í”„ë¼ì´ë²„ì‹œ ì¹¨í•´)
  - `service_role` í‚¤ í´ë¼ì´ì–¸íŠ¸ ë²ˆë“¤ì— í¬í•¨ ê¸ˆì§€
  - ì§ì ‘ì ì¸ Supabase ì“°ê¸° (RLS ì •ì±… ìœ„ë°˜ ê°€ëŠ¥ì„±)

### 2.1.2 BFF Layer

**FastAPI Service**
- **ì±…ìž„**:
  - ëª¨ë“  ì“°ê¸° ìž‘ì—…ì˜ ë‹¨ì¼ ì§„ìž…ì 
  - ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦ (ì˜ˆ: í•˜ë£¨ í•œ ì¹´ë“œë§Œ ì™„ë£Œ ê°€ëŠ¥)
  - Gamification ë¡œì§ (í¬ì¸íŠ¸, ìŠ¤íŠ¸ë¦­, ë°°ì§€ ë¶€ì—¬)
  - ì™¸ë¶€ API ì—°ë™ (LLM, ì‚¬ê¸° ê²€ì‚¬ ì™¸ë¶€ DB, ìŒì„± ì²˜ë¦¬)
  - Supabaseì— `service_role`ë¡œ ì ‘ê·¼ (RLS ìš°íšŒ ê°€ëŠ¥)
  - Redisë¥¼ í†µí•œ ìºì‹±, ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ…, ì„¸ì…˜ ê´€ë¦¬
  - ê°ì‚¬ ë¡œê·¸(audit_logs) ê¸°ë¡
- **ê¸ˆì§€ ì‚¬í•­**:
  - UI ë Œë”ë§ ë¡œì§ í¬í•¨ ê¸ˆì§€
  - ì‚¬ìš©ìžë³„ ìƒíƒœ ì €ìž¥ ê¸ˆì§€ (stateless ìœ ì§€)
  - ìž¥ê¸° ì‹¤í–‰ ìž‘ì—…ì€ ë°±ê·¸ë¼ìš´ë“œ íë¡œ ìœ„ìž„ (ì´ˆê¸° MVPëŠ” ë™ê¸° ì²˜ë¦¬)

### 2.1.3 Data Layer

**Supabase (Postgres + Auth + RLS + Storage)**
- **ì±…ìž„**:
  - ëª¨ë“  ì˜êµ¬ ë°ì´í„° ì €ìž¥
  - Row-Level Security(RLS)ë¥¼ í†µí•œ ì½ê¸° ê¶Œí•œ ì œì–´
  - Auth: ì‹œë‹ˆì–´(user), ê°€ì¡±(guardian), ê¸°ê´€(org) ì—­í•  ê´€ë¦¬
  - Storage: í”„ë¡œí•„ ì´ë¯¸ì§€, ì¹´ë“œ ì¸ë„¤ì¼ (S3 í˜¸í™˜)
- **ì ‘ê·¼ íŒ¨í„´**:
  - í´ë¼ì´ì–¸íŠ¸ â†’ `anon_key` + RLS â†’ ì•ˆì „í•œ ì½ê¸°
  - BFF â†’ `service_role` â†’ ëª¨ë“  ì“°ê¸° + ë³µìž¡í•œ ì¡°íšŒ

**Redis (Upstash)**
- **ì±…ìž„**:
  - ì„¸ì…˜ ìºì‹œ (ì§§ì€ ìˆ˜ëª… í† í°, ì‚¬ìš©ìž í”„ë¡œí•„)
  - API ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ… (ì˜ˆ: ì‚¬ê¸°ê²€ì‚¬ 1ë¶„ 5íšŒ)
  - LLM ì‘ë‹µ ìºì‹œ (ë™ì¼ ìž…ë ¥ ìž¬ì‚¬ìš©)
  - ë¦¬ë”ë³´ë“œ/ì¹´ìš´í„° ìž„ì‹œ ì €ìž¥ (ë°°ì¹˜ë¡œ Postgres ë™ê¸°í™”)
- **ê¸ˆì§€ ì‚¬í•­**:
  - ì˜êµ¬ ë°ì´í„° ì €ìž¥ ê¸ˆì§€ (eviction ê°€ëŠ¥)
  - ë¯¼ê° ì •ë³´ ìž¥ê¸° ë³´ê´€ ê¸ˆì§€

## 2.2 Data Flow Diagrams

### 2.2.1 Daily Card Read & Complete

```
[ì‹œë‹ˆì–´ ì•±]
  â†“ GET /api/cards/today (with auth token)
[Supabase Auth] í† í° ê²€ì¦ â†’ user_id ì¶”ì¶œ
  â†“
[Supabase RLS] cards í…Œì´ë¸” ì¡°íšŒ
  - WHERE user_id = {current_user}
  - WHERE date = {today}
  - RLS: auth.uid() = cards.user_id
  â†“
[ì‹œë‹ˆì–´ ì•±] ì¹´ë“œ ë Œë”ë§, TTS ìž¬ìƒ, í€´ì¦ˆ í‘œì‹œ
  â†“ (ì‚¬ìš©ìžê°€ "ì™„ë£Œ" ë²„íŠ¼ í´ë¦­)
[ì‹œë‹ˆì–´ ì•±] POST /bff/cards/{card_id}/complete (with auth token)
  â†“
[FastAPI BFF]
  1) í† í° ê²€ì¦ (Supabase Auth)
  2) ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦:
     - ì´ë¯¸ ì™„ë£Œëœ ì¹´ë“œì¸ì§€ í™•ì¸
     - ê°™ì€ ë‚ ì§œì— ì¤‘ë³µ ì™„ë£Œ ê¸ˆì§€
  3) Supabase (service_role) ì—…ë°ì´íŠ¸:
     - cards.completed_at = NOW()
     - cards.status = 'completed'
  4) Gamification ì„œë¹„ìŠ¤ í˜¸ì¶œ:
     - gamification.points += 10
     - ì—°ì†ì¼ìˆ˜ í™•ì¸ â†’ streak ì—…ë°ì´íŠ¸
     - ë°°ì§€ ì¡°ê±´ í™•ì¸ (ì˜ˆ: ì²« ì¹´ë“œ ì™„ë£Œ)
  5) audit_logs ê¸°ë¡:
     - action: 'card_completed', user_id, card_id, timestamp
  â†“
[FastAPI] 200 OK ì‘ë‹µ (í¬ì¸íŠ¸, ë°°ì§€ ì •ë³´ í¬í•¨)
  â†“
[ì‹œë‹ˆì–´ ì•±] ì¶•í•˜ ì• ë‹ˆë©”ì´ì…˜ + í¬ì¸íŠ¸ í‘œì‹œ
```

### 2.2.2 Insight ì¡°íšŒ

```
[ì‹œë‹ˆì–´ ì•±] ì¸ì‚¬ì´íŠ¸ í—ˆë¸Œ ì§„ìž…
  â†“ GET /api/insights?topic=ai&limit=10
[Supabase Auth] í† í° ê²€ì¦
  â†“
[Supabase RLS] insights í…Œì´ë¸” ì¡°íšŒ
  - WHERE topic = 'ai'
  - ORDER BY published_at DESC
  - LIMIT 10
  - RLS: insights.is_published = true (ëª¨ë“  ì¸ì¦ ì‚¬ìš©ìž)
  â†“
[ì‹œë‹ˆì–´ ì•±] ì¸ì‚¬ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
  â†“ (ì‚¬ìš©ìžê°€ íŠ¹ì • ì¸ì‚¬ì´íŠ¸ í´ë¦­)
[ì‹œë‹ˆì–´ ì•±] GET /api/insights/{id}
  â†“
[Supabase RLS] ìƒì„¸ ì¡°íšŒ + reactions ì¡°ì¸
  â†“
[ì‹œë‹ˆì–´ ì•±] ì¸ì‚¬ì´íŠ¸ ë³¸ë¬¸, TTS, ë°˜ì‘ ë²„íŠ¼ í‘œì‹œ
  â†“ (ì‚¬ìš©ìžê°€ "ë„ì›€ëì–´ìš”" í´ë¦­)
[ì‹œë‹ˆì–´ ì•±] POST /bff/insights/{id}/react (type: 'useful')
  â†“
[FastAPI BFF]
  1) í† í° ê²€ì¦
  2) reactions í…Œì´ë¸” upsert:
     - ì´ë¯¸ ê°™ì€ íƒ€ìž… ë°˜ì‘ ì¡´ìž¬ â†’ ì·¨ì†Œ
     - ì—†ìœ¼ë©´ â†’ INSERT
  3) ì¹´ìš´í„° ì—…ë°ì´íŠ¸ (insights.useful_count += 1)
  4) Gamification: ì²« ë°˜ì‘ ì‹œ +2 í¬ì¸íŠ¸
  â†“
[FastAPI] 200 OK (ìƒˆ ì¹´ìš´íŠ¸ ë°˜í™˜)
  â†“
[ì‹œë‹ˆì–´ ì•±] ì• ë‹ˆë©”ì´ì…˜ + ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
```

### 2.2.3 Voice Intent ì²˜ë¦¬

```
[ì‹œë‹ˆì–´ ì•±] í™ˆ í™”ë©´ â†’ "ë§í•˜ê¸°" ë²„íŠ¼ íƒ­
  â†“
[Expo Speech] ìŒì„± ë…¹ìŒ ì‹œìž‘
  â†“ (ì‚¬ìš©ìž: "ì—„ë§ˆì—ê²Œ ì „í™”í•´ ì¤˜")
[Expo Speech] ìŒì„± â†’ í…ìŠ¤íŠ¸ ë³€í™˜ (OS ë ˆë²¨ STT)
  â†“
[ì‹œë‹ˆì–´ ì•±] POST /bff/voice/parse
  - body: { text: "ì—„ë§ˆì—ê²Œ ì „í™”í•´ ì¤˜" }
  â†“
[FastAPI BFF]
  1) í† í° ê²€ì¦
  2) voice_parser ì„œë¹„ìŠ¤ (ë£° ê¸°ë°˜):
     - "ì „í™”" í‚¤ì›Œë“œ ê°ì§€ â†’ intent: 'call'
     - "ì—„ë§ˆ" ì¶”ì¶œ â†’ slot: { contact_name: "ì—„ë§ˆ" }
  3) contacts í…Œì´ë¸” ì¡°íšŒ (ì—°ë½ì²˜ ì •ë³´):
     - WHERE user_id = {current_user}
     - WHERE name ILIKE '%ì—„ë§ˆ%'
     - ê²°ê³¼: phone_number íšë“
  4) action ìƒì„±:
     - { action: 'call', phone: '+821012345678' }
  â†“
[FastAPI] 200 OK
  - { intent: 'call', contact: 'ì—„ë§ˆ', phone: '+821012345678' }
  â†“
[ì‹œë‹ˆì–´ ì•±]
  1) í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸: "ì—„ë§ˆ(010-1234-5678)ì—ê²Œ ì „í™”ë¥¼ ê±¸ê¹Œìš”?"
  2) ì‚¬ìš©ìž ìŠ¹ì¸ â†’ Linking.openURL('tel:+821012345678')
  3) OS ì „í™” ì•±ìœ¼ë¡œ ì „í™˜
  â†“
[ì‹œë‹ˆì–´ ì•±] Gamification: ìŒì„± ì¸í…íŠ¸ ì‚¬ìš© +5 í¬ì¸íŠ¸ (BFF í˜¸ì¶œ)
```

### 2.2.4 Scam Check

```
[ì‹œë‹ˆì–´ ì•±] í™ˆ â†’ "ì‚¬ê¸°ê²€ì‚¬" ê¸°ëŠ¥
  â†“ (ì‚¬ìš©ìžê°€ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ë¬¸ìž ë³µì‚¬-ë¶™ì—¬ë„£ê¸°)
[ì‹œë‹ˆì–´ ì•±] POST /bff/scam/check
  - body: { text: "êµ­ì„¸ì²­ìž…ë‹ˆë‹¤. í™˜ê¸‰ê¸ˆ 200ë§Œì›...", url: null }
  â†“
[FastAPI BFF]
  1) í† í° ê²€ì¦
  2) ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ… í™•ì¸ (Redis):
     - key: scam_check:{user_id}
     - 1ë¶„ 5íšŒ ì œí•œ
  3) scam_checker ì„œë¹„ìŠ¤ (ë£° ê¸°ë°˜):
     - í‚¤ì›Œë“œ ë§¤ì¹­: "í™˜ê¸‰ê¸ˆ", "êµ­ì„¸ì²­", "ê¸´ê¸‰", "í´ë¦­"
     - ì ìˆ˜ ì‚°ì¶œ: keyword_score + urgency_score
     - URL ì¡´ìž¬ ì‹œ:
       - ë„ë©”ì¸ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ í™•ì¸
       - ë‹¨ì¶• URL ê°ì§€ (bit.ly, t.co ë“±)
       - ìœ ì‚¬ ë„ë©”ì¸ ê²€ì‚¬ (goverment.kr vs government.go.kr)
  4) íŒì •:
     - score >= 80: 'danger'
     - score 40-79: 'warn'
     - score < 40: 'safe'
  5) ì„¤ëª… ìƒì„±:
     - "í™˜ê¸‰ê¸ˆê³¼ ê¸´ê¸‰ í´ë¦­ ìš”êµ¬ëŠ” ì „í˜•ì ì¸ ìŠ¤ë¯¸ì‹± ìˆ˜ë²•ìž…ë‹ˆë‹¤."
  6) audit_logs ê¸°ë¡
  7) usage_counters.scam_checks += 1
  â†“
[FastAPI] 200 OK
  - { label: 'danger', confidence: 0.85, explanation: "...", tips: "..." }
  â†“
[ì‹œë‹ˆì–´ ì•±]
  - ê²½ê³  ìƒ‰ìƒ(ë¹¨ê°•) + í° ê²½ê³  ì•„ì´ì½˜
  - ì„¤ëª… + "ì ˆëŒ€ ë§í¬ í´ë¦­í•˜ì§€ ë§ˆì„¸ìš”" í–‰ë™ íŒ
  - TTS ìžë™ ìž¬ìƒ (ì„ íƒ)
  â†“
[ì‹œë‹ˆì–´ ì•±] Gamification: ì‚¬ê¸°ê²€ì‚¬ ì‚¬ìš© +3 í¬ì¸íŠ¸
```

### 2.2.5 Tool Track ë‹¨ê³„ ì™„ë£Œ

```
[ì‹œë‹ˆì–´ ì•±] ë„êµ¬ ì‹¤ìŠµ â†’ "ë¯¸ë¦¬ìº”ë²„ìŠ¤" íŠ¸ëž™ ì§„ìž…
  â†“ GET /api/tools/tracks/{track_id}
[Supabase RLS] tool_tracks í…Œì´ë¸” ì¡°íšŒ
  - steps ë°°ì—´ ë°˜í™˜ (JSON)
  â†“
[ì‹œë‹ˆì–´ ì•±] 1ë‹¨ê³„ í™”ë©´ ë Œë”ë§ (ëª©í‘œ, ì„¤ëª…, ì²´í¬ë¦¬ìŠ¤íŠ¸, í€´ì¦ˆ)
  â†“ (ì‚¬ìš©ìžê°€ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì™„ë£Œ + í€´ì¦ˆ ì •ë‹µ)
[ì‹œë‹ˆì–´ ì•±] POST /bff/tools/tracks/{track_id}/steps/{step_num}/complete
  â†“
[FastAPI BFF]
  1) í† í° ê²€ì¦
  2) ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™:
     - ì´ì „ ë‹¨ê³„ ì™„ë£Œ ì—¬ë¶€ í™•ì¸ (step_num - 1)
     - ì´ë¯¸ ì™„ë£Œëœ ë‹¨ê³„ëŠ” ìž¬ì™„ë£Œ í—ˆìš© (ìž¬í•™ìŠµ)
  3) tools_progress í…Œì´ë¸” upsert:
     - WHERE user_id = {current_user}
       AND track_id = {track_id}
       AND step_num = {step_num}
     - SET completed_at = NOW()
  4) Gamification:
     - ë‹¨ê³„ ì™„ë£Œ +5 í¬ì¸íŠ¸
     - ì „ì²´ íŠ¸ëž™ ì™„ë£Œ ì‹œ ë°°ì§€ "ë„êµ¬ ë§ˆìŠ¤í„°" ë¶€ì—¬
  5) ë‹¤ìŒ ë‹¨ê³„ ì–¸ë½ (progress.unlocked_steps ì—…ë°ì´íŠ¸)
  â†“
[FastAPI] 200 OK (ì§„í–‰ë¥ , í¬ì¸íŠ¸, ë°°ì§€ ì •ë³´)
  â†“
[ì‹œë‹ˆì–´ ì•±]
  - ì¶•í•˜ ì• ë‹ˆë©”ì´ì…˜
  - ì§„í–‰ë¥  ë°” ì—…ë°ì´íŠ¸ (1/4 â†’ 2/4)
  - ë‹¤ìŒ ë‹¨ê³„ ë²„íŠ¼ í™œì„±í™”
```

### 2.2.6 Q&A ìž‘ì„±/ì¡°íšŒ

```
[ì‹œë‹ˆì–´ ì•±] ì»¤ë®¤ë‹ˆí‹° â†’ Q&A â†’ "ì§ˆë¬¸í•˜ê¸°"
  â†“ (ì‚¬ìš©ìžê°€ ì œëª©, ë³¸ë¬¸, ì£¼ì œ ì„ íƒ, ìµëª… ì²´í¬)
[ì‹œë‹ˆì–´ ì•±] POST /bff/community/qna
  - body: {
      subject: "í°",
      title: "ì‚¬ì§„ ìš©ëŸ‰ ì¤„ì´ëŠ” ë²•",
      body: "...",
      is_anon: true
    }
  â†“
[FastAPI BFF]
  1) í† í° ê²€ì¦
  2) ë‚´ìš© ê²€ì¦:
     - ê¸ˆì¹™ì–´ í•„í„° (ìš•ì„¤, ìŠ¤íŒ¸ í‚¤ì›Œë“œ)
     - ê¸¸ì´ ì œí•œ (ì œëª© 100ìž, ë³¸ë¬¸ 1000ìž)
  3) AI ìš”ì•½ ìƒì„± (ì´ˆê¸° MVPëŠ” ë£° ê¸°ë°˜):
     - ì²« 50ìž + "..." ë˜ëŠ” ì œëª© ë³µì‚¬
  4) qna_posts í…Œì´ë¸” INSERT:
     - author_id: {current_user} (ì‹¤ì œ ì €ìž¥)
     - display_name: is_anon ? "ìµëª…" : profile.nickname
     - ai_summary: "ì‚¬ì§„ ìš©ëŸ‰ ì¤„ì´ëŠ” ë°©ë²• ì§ˆë¬¸"
  5) usage_counters.qna_posts += 1
  6) audit_logs ê¸°ë¡
  â†“
[FastAPI] 201 Created (post_id ë°˜í™˜)
  â†“
[ì‹œë‹ˆì–´ ì•±] "ì§ˆë¬¸ì´ ë“±ë¡ë˜ì—ˆì–´ìš”!" â†’ Q&A ëª©ë¡ìœ¼ë¡œ ì´ë™
  â†“
[ë‹¤ë¥¸ ì‚¬ìš©ìž ì•±] Q&A ëª©ë¡ ìƒˆë¡œê³ ì¹¨
  â†“ GET /api/community/qna?subject=í°&limit=20
[Supabase RLS]
  - qna_posts ì¡°íšŒ (is_deleted = false)
  - JOIN qna_votes (íˆ¬í‘œ ìˆ˜)
  - ORDER BY created_at DESC
  â†“
[ì‹œë‹ˆì–´ ì•±] ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ (ìµëª…/ë‹‰ë„¤ìž„, ì œëª©, ai_summary, ë°˜ì‘ ìˆ˜)
  â†“ (íŠ¹ì • ì§ˆë¬¸ í´ë¦­)
[ì‹œë‹ˆì–´ ì•±] GET /api/community/qna/{post_id}
  â†“
[Supabase RLS] ìƒì„¸ ì¡°íšŒ + comments (ì´ˆê¸° MVPëŠ” ëŒ“ê¸€ ìƒëžµ)
  â†“
[ì‹œë‹ˆì–´ ì•±] ë³¸ë¬¸, íˆ¬í‘œ ë²„íŠ¼ ("ë„ì›€ëì–´ìš”") í‘œì‹œ
```

### 2.2.7 Med Check & ê°€ì¡± ëŒ€ì‹œë³´ë“œ ë°˜ì˜

```
[ì‹œë‹ˆì–´ ì•±] í™ˆ í™”ë©´ â†’ "ì˜¤ëŠ˜ ì•½ ë¨¹ê¸° ì²´í¬í•˜ê¸°" í° ë²„íŠ¼
  â†“ (ì‚¬ìš©ìžê°€ ë²„íŠ¼ íƒ­)
[ì‹œë‹ˆì–´ ì•±] POST /bff/med/check
  - body: { date: "2025-11-13", time: "09:00" }
  â†“
[FastAPI BFF]
  1) í† í° ê²€ì¦
  2) ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™:
     - í•˜ë£¨ ìµœëŒ€ 3íšŒ ì²´í¬ (ì•„ì¹¨/ì ì‹¬/ì €ë…)
     - ì´ë¯¸ í•´ë‹¹ ì‹œê°„ëŒ€ ì²´í¬ ì™„ë£Œ ì‹œ â†’ 409 Conflict
  3) med_checks í…Œì´ë¸” INSERT:
     - user_id, date, time_slot: 'morning', checked_at: NOW()
  4) Gamification:
     - +3 í¬ì¸íŠ¸
     - ì—°ì† 7ì¼ ì²´í¬ ì‹œ "ê¾¸ì¤€í•œ ê±´ê°• ê´€ë¦¬ìž" ë°°ì§€
     - streak ì—…ë°ì´íŠ¸
  5) usage_counters.med_checks += 1
  6) ê°€ì¡± ì•Œë¦¼ íŠ¸ë¦¬ê±° (ì„ íƒì ):
     - family_links ì¡°íšŒ (guardian_id)
     - alerts í…Œì´ë¸” INSERT (type: 'med_checked')
  â†“
[FastAPI] 200 OK (í¬ì¸íŠ¸, ìŠ¤íŠ¸ë¦­, ì¶•í•˜ ë©”ì‹œì§€)
  â†“
[ì‹œë‹ˆì–´ ì•±]
  - ì²´í¬ ì™„ë£Œ ì• ë‹ˆë©”ì´ì…˜
  - "ì˜¤ëŠ˜ ì•„ì¹¨ ì•½ì„ ì±™ê²¼ì–´ìš”! 3ì¼ ì—°ì†ì´ì—ìš” ðŸ‘"
  - í¬ì¸íŠ¸ ì¦ê°€ í‘œì‹œ
  â†“
[ê°€ì¡± ì›¹ ëŒ€ì‹œë³´ë“œ]
  - ì‹¤ì‹œê°„ ë˜ëŠ” ë‹¤ìŒ ìƒˆë¡œê³ ì¹¨ ì‹œ
  - GET /bff/family/senior/{senior_id}/summary (with guardian token)
  â†“
[FastAPI BFF]
  1) guardian í† í° ê²€ì¦
  2) family_links í™•ì¸:
     - WHERE guardian_id = {current_user}
       AND senior_id = {senior_id}
       AND status = 'active'
  3) ê¶Œí•œ í™•ì¸ í›„ ë°ì´í„° ì¡°íšŒ:
     - ìµœê·¼ 7ì¼ ì¹´ë“œ ì™„ë£Œ ì—¬ë¶€ (cards)
     - ìµœê·¼ 7ì¼ ë³µì•½ ì²´í¬ (med_checks)
     - ì‚¬ìš©ëŸ‰ ì¹´ìš´í„° (usage_counters)
     - ë¯¼ê° ì •ë³´ ì œì™¸ (êµ¬ì²´ì  ì¹´ë“œ ë‚´ìš©, Q&A ë³¸ë¬¸ ë“±)
  â†“
[FastAPI] 200 OK (ìš”ì•½ ë°ì´í„°)
  â†“
[ê°€ì¡± ì›¹] ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸:
  - "ì–´ë¨¸ë‹ˆëŠ” ì˜¤ëŠ˜ ì•„ì¹¨ ì•½ì„ ì±™ê²¼ì–´ìš” âœ“"
  - ì£¼ê°„ ì¹´ë“œ ì™„ë£Œ: 5/7ì¼
  - ë³µì•½ ìŠ¤íŠ¸ë¦­: 3ì¼ ì—°ì†
```

---

---
